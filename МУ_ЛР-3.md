# –ø–æ—à–∞–≥–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –õ–†3 "–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ DVC –ø–∞–π–ø–ª–∞–π–Ω" –†–∞–±–æ—Ç–∞–µ–º –ø–æ –ø—Ä–µ–∂–Ω–µ–º—É –Ω–∞ —à–∞–±–ª–æ–Ω–µ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è [https://github.com/Irina-64/mlops-flight-delay](https://github.com/Irina-64/mlops-flight-delay)

–ì–æ—Ç–æ–≤–ª—é –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ø–æ—à–∞–≥–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Ññ3 "–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ DVC –ø–∞–π–ø–ª–∞–π–Ω" –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–µ–º–æ-–ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫ —Ä–µ–π—Å–æ–≤.

# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ3: –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ DVC –ø–∞–π–ø–ª–∞–π–Ω

**–¶–µ–ª—å:** –ù–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º DVC –¥–ª—è MLOps-–ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫ —Ä–µ–π—Å–æ–≤.

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 3-4 —á–∞—Å–∞

**–ò—Å—Ö–æ–¥–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª:** [mlops-flight-delay](https://github.com/Irina-64/mlops-flight-delay)

***

## üìã –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–±–æ—Ç–µ

### –®–∞–≥ 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/Irina-64/mlops-flight-delay.git
cd mlops-flight-delay

# –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏ –¥–ª—è Windows: venv\Scripts\activate

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```


### –®–∞–≥ 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DVC

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º DVC –≤ –ø—Ä–æ–µ–∫—Ç–µ
dvc init

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
git status
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í –ø—Ä–æ–µ–∫—Ç–µ –ø–æ—è–≤—è—Ç—Å—è —Ñ–∞–π–ª—ã `.dvc/config`, `.dvcignore` –∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è `.gitignore`.

***

## üìä –ß–∞—Å—Ç—å 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ DVC tracking

### –®–∞–≥ 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ–π—Å–∞—Ö

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏/—Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```python
# data/generate_flight_data.py
import pandas as pd
import numpy as np
from datetime import datetime, timedelta

def generate_flight_data(n_records=10000):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ–π—Å–∞—Ö"""
    np.random.seed(42)
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    airlines = ['AA', 'UA', 'DL', 'SW', 'JB']
    airports = ['JFK', 'LAX', 'ORD', 'ATL', 'DFW', 'SFO', 'LAS', 'SEA']
    
    data = {
        'flight_date': pd.date_range('2023-01-01', periods=n_records, freq='H'),
        'airline': np.random.choice(airlines, n_records),
        'origin': np.random.choice(airports, n_records),
        'dest': np.random.choice(airports, n_records),
        'scheduled_dep_time': np.random.randint(0, 2400, n_records),
        'scheduled_arr_time': np.random.randint(0, 2400, n_records),
        'distance': np.random.randint(200, 3000, n_records),
        'weather_delay': np.random.exponential(5, n_records),
        'security_delay': np.random.exponential(2, n_records),
        'airline_delay': np.random.exponential(3, n_records),
        'late_aircraft_delay': np.random.exponential(4, n_records),
    }
    
    df = pd.DataFrame(data)
    
    # –°–æ–∑–¥–∞–µ–º —Ü–µ–ª–µ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é: –∑–∞–¥–µ—Ä–∂–∫–∞ > 15 –º–∏–Ω—É—Ç
    total_delay = (df['weather_delay'] + df['security_delay'] + 
                  df['airline_delay'] + df['late_aircraft_delay'])
    df['is_delayed'] = (total_delay > 15).astype(int)
    df['delay_minutes'] = total_delay
    
    return df

if __name__ == "__main__":
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
    df = generate_flight_data(50000)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ raw –¥–∞–Ω–Ω—ã–µ
    df.to_csv('data/raw/flights.csv', index=False)
    print(f"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ {len(df)} –∑–∞–ø–∏—Å–µ–π –≤ data/raw/flights.csv")
```

```bash
# –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir -p data/raw data/processed

# –ó–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
python data/generate_flight_data.py
```


### –®–∞–≥ 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ DVC

```bash
# –î–æ–±–∞–≤–ª—è–µ–º raw –¥–∞–Ω–Ω—ã–µ –≤ DVC
dvc add data/raw/flights.csv

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–æ–∑–¥–∞–ª–æ—Å—å
ls -la data/raw/
# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å: flights.csv –∏ flights.csv.dvc

# –î–æ–±–∞–≤–ª—è–µ–º –≤ git —Ç–æ–ª—å–∫–æ .dvc —Ñ–∞–π–ª
git add data/raw/flights.csv.dvc .gitignore
git commit -m "Add raw flight data with DVC tracking"
```


***

## üîß –ß–∞—Å—Ç—å 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏

### –®–∞–≥ 5. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏

–°–æ–∑–¥–∞–π—Ç–µ `src/preprocess.py`:

```python
import pandas as pd
import numpy as np
from sklearn.preprocessing import StandardScaler, LabelEncoder
import joblib
import yaml
import argparse
import os

def load_config(config_path='params.yaml'):
    """–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
    with open(config_path, 'r') as f:
        config = yaml.safe_load(f)
    return config

def preprocess_flight_data(raw_path, processed_path, config):
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö"""
    print(f"–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ {raw_path}")
    df = pd.read_csv(raw_path)
    
    print(f"–ò—Å—Ö–æ–¥–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: {df.shape}")
    
    # 1. –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    df = clean_data(df, config['preprocess'])
    
    # 2. Feature engineering
    df = create_features(df, config['preprocess'])
    
    # 3. –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
    df, encoders = encode_categorical(df, config['preprocess'])
    
    # 4. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
    df, scaler = scale_numerical(df, config['preprocess'])
    
    print(f"–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: {df.shape}")
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    os.makedirs(os.path.dirname(processed_path), exist_ok=True)
    df.to_csv(processed_path, index=False)
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤
    joblib.dump(encoders, 'models/encoders.pkl')
    joblib.dump(scaler, 'models/scaler.pkl')
    
    return df

def clean_data(df, config):
    """–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö"""
    # –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
    initial_shape = df.shape[^0]
    df = df.drop_duplicates()
    print(f"–£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: {initial_shape - df.shape[^0]}")
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤
    if config['handle_missing']:
        df = df.dropna(subset=['origin', 'dest', 'airline'])
        df = df.fillna(0)  # –ó–∞–ø–æ–ª–Ω—è–µ–º —á–∏—Å–ª–æ–≤—ã–µ –ø—Ä–æ–ø—É—Å–∫–∏
    
    # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—ã–±—Ä–æ—Å–æ–≤
    if config['remove_outliers']:
        # –£–¥–∞–ª—è–µ–º —Ä–µ–π—Å—ã —Å –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ (>500 –º–∏–Ω—É—Ç)
        df = df[df['delay_minutes'] <= 500]
        print(f"–†–∞–∑–º–µ—Ä –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤—ã–±—Ä–æ—Å–æ–≤: {df.shape}")
    
    return df

def create_features(df, config):
    """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤"""
    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—Ä–µ–º—è –≤ —É–¥–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    df['dep_hour'] = df['scheduled_dep_time'] // 100
    df['dep_minute'] = df['scheduled_dep_time'] % 100
    
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–∑–Ω–∞–∫ "–≤—Ä–µ–º—è –¥–Ω—è"
    df['time_of_day'] = pd.cut(df['dep_hour'], 
                              bins=[0, 6, 12, 18, 24], 
                              labels=['night', 'morning', 'afternoon', 'evening'])
    
    # –ü—Ä–∏–∑–Ω–∞–∫ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –¥–Ω—è
    df['flight_date'] = pd.to_datetime(df['flight_date'])
    df['is_weekend'] = (df['flight_date'].dt.dayofweek >= 5).astype(int)
    df['month'] = df['flight_date'].dt.month
    df['day_of_week'] = df['flight_date'].dt.dayofweek
    
    # –ë–∏–Ω–∞—Ä–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫ "–¥–∞–ª—å–Ω–∏–π —Ä–µ–π—Å"
    df['is_long_distance'] = (df['distance'] > df['distance'].quantile(0.75)).astype(int)
    
    # –°—É–º–º–∞—Ä–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ —Ç–∏–ø–∞–º
    delay_cols = ['weather_delay', 'security_delay', 'airline_delay', 'late_aircraft_delay']
    df['total_delay'] = df[delay_cols].sum(axis=1)
    
    return df

def encode_categorical(df, config):
    """–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤"""
    categorical_cols = ['airline', 'origin', 'dest', 'time_of_day']
    encoders = {}
    
    for col in categorical_cols:
        if col in df.columns:
            encoder = LabelEncoder()
            df[f'{col}_encoded'] = encoder.fit_transform(df[col].astype(str))
            encoders[col] = encoder
    
    return df, encoders

def scale_numerical(df, config):
    """–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤"""
    numerical_cols = ['distance', 'dep_hour', 'month', 'day_of_week', 
                     'weather_delay', 'security_delay', 'airline_delay', 
                     'late_aircraft_delay', 'is_weekend', 'is_long_distance']
    
    scaler = StandardScaler()
    df[numerical_cols] = scaler.fit_transform(df[numerical_cols])
    
    return df, scaler

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--config", default="params.yaml", help="Config file path")
    args = parser.parse_args()
    
    config = load_config(args.config)
    
    preprocess_flight_data(
        raw_path=config['data']['raw'],
        processed_path=config['data']['processed'],
        config=config
    )
```


### –®–∞–≥ 6. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π—Ç–µ `params.yaml`:

```yaml
data:
  raw: "data/raw/flights.csv"
  processed: "data/processed/flights_processed.csv"

preprocess:
  handle_missing: true
  remove_outliers: true
  test_size: 0.2
  random_state: 42

model:
  algorithm: "random_forest"
  n_estimators: 100
  max_depth: 10
  random_state: 42

train:
  learning_rate: 0.01
  epochs: 100
```


### –®–∞–≥ 7. –°–æ–∑–¥–∞–Ω–∏–µ DVC –ø–∞–π–ø–ª–∞–π–Ω–∞

–°–æ–∑–¥–∞–π—Ç–µ `dvc.yaml`:

```yaml
stages:
  preprocess:
    cmd: python src/preprocess.py --config params.yaml
    deps:
      - data/raw/flights.csv
      - src/preprocess.py
      - params.yaml
    outs:
      - data/processed/flights_processed.csv
      - models/encoders.pkl
      - models/scaler.pkl
    params:
      - preprocess
```


***

## üöÄ –ß–∞—Å—Ç—å 3. –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞

### –®–∞–≥ 8. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞

```bash
# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –º–æ–¥–µ–ª–µ–π
mkdir -p models

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞–π–ø–ª–∞–π–Ω
dvc repro

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–æ–∑–¥–∞–ª–æ—Å—å
ls -la data/processed/
ls -la models/
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Ñ–∞–π–ª—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã.

### –®–∞–≥ 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
dvc status

# –°–º–æ—Ç—Ä–∏–º DAG –ø–∞–π–ø–ª–∞–π–Ω–∞
dvc dag

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞–¥–∏–∏
dvc stage list
```


### –®–∞–≥ 10. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å

```bash
# –ò–∑–º–µ–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ params.yaml
sed -i 's/remove_outliers: true/remove_outliers: false/' params.yaml

# DVC –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
dvc status

# –ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏
dvc repro

# –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
dvc params diff
```


***

## üìä –ß–∞—Å—Ç—å 4. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞

### –®–∞–≥ 11. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ `src/split_data.py`:

```python
import pandas as pd
from sklearn.model_selection import train_test_split
import yaml
import argparse
import os

def load_config(config_path='params.yaml'):
    with open(config_path, 'r') as f:
        return yaml.safe_load(f)

def split_data(processed_path, config):
    """–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ train/test"""
    df = pd.read_csv(processed_path)
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏ —Ü–µ–ª–µ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    feature_cols = [col for col in df.columns if col not in ['is_delayed', 'delay_minutes', 'flight_date']]
    
    X = df[feature_cols]
    y = df['is_delayed']
    
    # –†–∞–∑–¥–µ–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
    X_train, X_test, y_train, y_test = train_test_split(
        X, y, 
        test_size=config['preprocess']['test_size'],
        random_state=config['preprocess']['random_state'],
        stratify=y
    )
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    os.makedirs('data/split', exist_ok=True)
    
    X_train.to_csv('data/split/X_train.csv', index=False)
    X_test.to_csv('data/split/X_test.csv', index=False)
    y_train.to_csv('data/split/y_train.csv', index=False)
    y_test.to_csv('data/split/y_test.csv', index=False)
    
    print(f"Train set: {X_train.shape}")
    print(f"Test set: {X_test.shape}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--config", default="params.yaml")
    args = parser.parse_args()
    
    config = load_config(args.config)
    split_data(config['data']['processed'], config)
```


### –®–∞–≥ 12. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ DVC –ø–∞–π–ø–ª–∞–π–Ω–∞

–î–æ–±–∞–≤—å—Ç–µ –≤ `dvc.yaml`:

```yaml
stages:
  preprocess:
    cmd: python src/preprocess.py --config params.yaml
    deps:
      - data/raw/flights.csv
      - src/preprocess.py
      - params.yaml
    outs:
      - data/processed/flights_processed.csv
      - models/encoders.pkl
      - models/scaler.pkl
    params:
      - preprocess
      
  split:
    cmd: python src/split_data.py --config params.yaml
    deps:
      - data/processed/flights_processed.csv
      - src/split_data.py
      - params.yaml
    outs:
      - data/split/X_train.csv
      - data/split/X_test.csv
      - data/split/y_train.csv
      - data/split/y_test.csv
    params:
      - preprocess.test_size
      - preprocess.random_state
```


***

## üîç –ß–∞—Å—Ç—å 5. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 13. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ `src/validate_data.py`:

```python
import pandas as pd
import json
import argparse

def validate_processed_data(data_path):
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
    df = pd.read_csv(data_path)
    
    validation_results = {}
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
    validation_results['data_shape'] = df.shape
    validation_results['missing_values'] = df.isnull().sum().sum()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
    validation_results['target_distribution'] = df['is_delayed'].value_counts().to_dict()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
    validation_results['data_types'] = df.dtypes.apply(str).to_dict()
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —á–∏—Å–ª–æ–≤—ã–º –∫–æ–ª–æ–Ω–∫–∞–º
    numeric_cols = df.select_dtypes(include=['float64', 'int64']).columns
    validation_results['numeric_stats'] = df[numeric_cols].describe().to_dict()
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
    with open('reports/data_validation.json', 'w') as f:
        json.dump(validation_results, f, indent=2)
    
    print("–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
    return validation_results

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--data", required=True, help="Path to processed data")
    args = parser.parse_args()
    
    # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
    import os
    os.makedirs('reports', exist_ok=True)
    
    validate_processed_data(args.data)
```


### –®–∞–≥ 14. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ –ø–∞–π–ø–ª–∞–π–Ω

–û–±–Ω–æ–≤–∏—Ç–µ `dvc.yaml`:

```yaml
stages:
  preprocess:
    cmd: python src/preprocess.py --config params.yaml
    deps:
      - data/raw/flights.csv
      - src/preprocess.py
      - params.yaml
    outs:
      - data/processed/flights_processed.csv
      - models/encoders.pkl
      - models/scaler.pkl
    params:
      - preprocess
      
  validate:
    cmd: python src/validate_data.py --data data/processed/flights_processed.csv
    deps:
      - data/processed/flights_processed.csv
      - src/validate_data.py
    outs:
      - reports/data_validation.json
      
  split:
    cmd: python src/split_data.py --config params.yaml
    deps:
      - data/processed/flights_processed.csv
      - src/split_data.py
      - params.yaml
    outs:
      - data/split/X_train.csv
      - data/split/X_test.csv
      - data/split/y_train.csv
      - data/split/y_test.csv
    params:
      - preprocess.test_size
      - preprocess.random_state
```


***

## ‚úÖ –ß–∞—Å—Ç—å 6. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 15. –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞

```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º –≤–µ—Å—å –ø–∞–π–ø–ª–∞–π–Ω
dvc repro

# –ü—Ä–æ–≤–µ—Ä—è–µ–º DAG
dvc dag

# –°–º–æ—Ç—Ä–∏–º –º–µ—Ç—Ä–∏–∫–∏
dvc metrics show

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
find . -name "*.csv" -o -name "*.pkl" -o -name "*.json" | grep -v .dvc
```


### –®–∞–≥ 16. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏

```bash
# –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
rm -rf data/processed/ data/split/ models/ reports/

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞–π–ø–ª–∞–π–Ω –∑–∞–Ω–æ–≤–æ
dvc repro

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ –≤–æ—Å—Å–æ–∑–¥–∞–ª–æ—Å—å
ls -la data/processed/ data/split/ models/ reports/
```


### –®–∞–≥ 17. –ö–æ–º–º–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
# –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –ø–∞–π–ø–ª–∞–π–Ω–∞ –≤ git
git add dvc.yaml dvc.lock src/ params.yaml

# –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
git commit -m "Add complete data preprocessing pipeline with DVC

- Added data preprocessing with feature engineering
- Added data validation step
- Added train/test split stage
- Configured reproducible pipeline with params.yaml"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
git log --oneline -5
```


***

## üìù –û—Ç—á–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–æ:

1. **–°–∫—Ä–∏–ø—Ç—ã –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏:**
    - `src/preprocess.py` - –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞
    - `src/split_data.py` - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    - `src/validate_data.py` - –≤–∞–ª–∏–¥–∞—Ü–∏—è
2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
    - `params.yaml` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–π–ø–ª–∞–π–Ω–∞
    - `dvc.yaml` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–π
    - `dvc.lock` - –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
3. **–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
    - `data/processed/flights_processed.csv`
    - `data/split/X_train.csv, X_test.csv, y_train.csv, y_test.csv`
4. **–ú–æ–¥–µ–ª–∏ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:**
    - `models/encoders.pkl` - –∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
    - `models/scaler.pkl` - —Å–∫–µ–π–ª–µ—Ä —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
    - `reports/data_validation.json` - –æ—Ç—á–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–π–ø–ª–∞–π–Ω–∞
dvc dag

# 2. –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π
dvc status

# 3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
dvc params show

# 4. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç–∞–¥–∏–∏
dvc repro preprocess

# 5. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
dvc diff
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

- ‚úÖ DVC –ø–∞–π–ø–ª–∞–π–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π `dvc repro`
- ‚úÖ –í—Å–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –Ω—É–∂–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ `params.yaml` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- ‚úÖ –ü–∞–π–ø–ª–∞–π–Ω –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –¥–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É —Ç–æ–ª—å–∫–æ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Å—Ç–∞–¥–∏–π

–≠—Ç–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–æ–∑–¥–∞–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º DVC –≤ —Ä–µ–∞–ª—å–Ω–æ–º ML-–ø—Ä–æ–µ–∫—Ç–µ.
<span style="display:none">[^1]</span>

<div align="center">‚ÅÇ</div>

[^1]: https://github.com/Irina-64/mlops-flight-delay

